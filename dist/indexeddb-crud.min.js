"use strict";var IndexedDBHandler=function(){var e=void 0,o=void 0,t={};function n(o,n){var a=e.transaction([o]);t[o]=0,r(a,o).onsuccess=function(e){var n=e.target.result;n&&(t[o]=n.value.id,n.continue())},a.oncomplete=function(){console.log("✓ now "+o+" 's max key is "+t[o]),n&&(n(),console.log("✓ openSuccessCallback finished"))}}function a(e,o){try{return JSON.parse(JSON.stringify(e))}catch(e){throw window.alert("please set correct "+o+" array object :)"),console.log(e),e}}function r(e,o){return e.objectStore(o).openCursor(IDBKeyRange.lowerBound(1),"next")}return{open:function(t,r,c){return window.indexedDB?(s=t,i=r,(l=window.indexedDB.open(s.name,s.version)).onblocked=function(){window.alert("Please close all other tabs with this site open")},l.onupgradeneeded=function(o){e=o.target.result,console.log("✓ onupgradeneeded in"),a(s.storeConfig,"storeName").forEach(function(o){var t;e.objectStoreNames.contains(o.storeName)||(t=o,e.createObjectStore(t.storeName,{keyPath:t.key,autoIncrement:!0}).transaction.oncomplete=function(){var o,r,c,s;console.log("✓ create "+t.storeName+" 's object store succeed"),t.initialData&&(o=t.storeName,r=t.initialData,c=e.transaction([o],"readwrite"),s=c.objectStore(o),a(r,"initial").forEach(function(e,o){var t=s.add(e);t.onsuccess=function(){console.log("✓ add initial data["+o+"] successed")}}),c.oncomplete=function(){console.log("✓ add all "+o+" 's initial data done :)"),n(o)})})})},l.onsuccess=function(t){var r,c,l;(e=t.target.result).onversionchange=function(){e.close(),window.alert("A new version of this page is ready. Please reload")},r=s.storeConfig,c=i,(l=a(r,"storeName")).forEach(function(e,t){t===l.length-1?n(e.storeName,function(){c(),console.log("✓ open indexedDB success")}):(o=e.storeName,n(e.storeName))})},l.onerror=function(e){throw window.alert("Something is wrong with indexedDB, for more information, checkout console"),console.log(e.target.error),new Error(e.target.error)},0):(c?c():window.alert("✔ Your browser doesn't support a stable version of IndexedDB. You can install latest Chrome or FireFox to handler it"),0);var s,i,l},getLength:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:o;return t[e]},getNewKey:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:o;return t[e]=1,t[e]},getItem:function(t,n){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:o,r=e.transaction([a]).objectStore(a).get(parseInt(t,10));r.onsuccess=function(){console.log("✓ get "+a+"'s "+r.source.keyPath+" = "+t+" data success :)"),n&&n(r.result)}},getWhetherConditionItem:function(t,n,a){var c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:o,s=e.transaction([c]),i=[];r(s,c).onsuccess=function(e){var o=e.target.result;o&&(n?o.value[t]&&i.push(o.value):n||o.value[t]||i.push(o.value),o.continue())},s.oncomplete=function(){console.log("✓ get "+c+"'s "+t+" = "+n+" data success :)"),a&&a(i)}},getAll:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:o,a=e.transaction([n]),c=[];r(a,n).onsuccess=function(e){var o=e.target.result;o&&(c.push(o.value),o.continue())},a.oncomplete=function(){console.log("✓ get "+n+"'s all data success :)"),t&&t(c)}},addItem:function(t,n){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:o,r=e.transaction([a],"readwrite").objectStore(a).add(t);r.onsuccess=function(){console.log("✓ add "+a+"'s "+r.source.keyPath+"  = "+t[r.source.keyPath]+" data succeed :)"),n&&n(t)}},removeItem:function(t,n){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:o,r=e.transaction([a],"readwrite").objectStore(a).delete(t);r.onsuccess=function(){console.log("✓ remove "+a+"'s  "+r.source.keyPath+" = "+t+" data success :)"),n&&n(t)}},removeWhetherConditionItem:function(t,n,a){var c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:o,s=e.transaction([c],"readwrite");r(s,c).onsuccess=function(e){var o=e.target.result;o&&(n?o.value[t]&&o.delete():n||o.value[t]||o.delete(),o.continue())},s.oncomplete=function(){console.log("✓ remove "+c+"'s "+t+" = "+n+" data success :)"),a&&a()}},clear:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:o,a=e.transaction([n],"readwrite");r(a,n).onsuccess=function(e){var o=e.target.result;o&&(o.delete(),o.continue())},a.oncomplete=function(){console.log("✓ clear "+n+"'s all data success :)"),t&&t("clear all data success")}},updateItem:function(t,n){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:o,r=e.transaction([a],"readwrite").objectStore(a).put(t);r.onsuccess=function(){console.log("✓ update "+a+"'s "+r.source.keyPath+"  = "+t[r.source.keyPath]+" data success :)"),n&&n(t)}}}}();module.exports=IndexedDBHandler;